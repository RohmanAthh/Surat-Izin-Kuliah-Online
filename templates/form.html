<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Form Surat Izin Kuliah</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <style>
    body {
      background-color: #f8f9fa;
      font-family: Arial, sans-serif;
    }
    .container {
      max-width: 700px;
      margin-top: 40px;
      padding: 25px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0px 3px 8px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
      font-weight: bold;
      color: #2c3e50;
    }
    label {
      font-weight: bold;
      margin-top: 10px;
    }
    canvas {
      border: 2px dashed #999;
      border-radius: 5px;
      margin-top: 10px;
    }
    .btn-primary {
      width: 100%;
      margin-top: 20px;
    }
    .btn-danger {
      margin-top: 10px;
    }
    iframe {
      margin-top: 30px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Form Surat Izin Kuliah</h2>
    <form method="POST" action="/generate">
      <div class="mb-3">
        <label>Nama Mahasiswa</label>
        <input type="text" class="form-control" name="nama" required autocomplete="name" placeholder="Contoh: Abdurrahman Athaillah">
      </div>
      <div class="mb-3">
        <label>NPM</label>
        <input type="text" class="form-control" name="npm" required autocomplete="username" placeholder="Contoh: 06.202x.x.xxxxx">
      </div>
      <div class="mb-3">
        <label>Program Studi</label>
        <select class="form-control" name="program" required autocomplete="on">
          <option value="">-- Pilih Program Studi --</option>
          <option value="Teknik Informatika">Teknik Informatika</option>
          <option value="Sistem Informasi">Sistem Informasi</option>
          <option value="Teknik Elektro">Teknik Elektro</option>
          <option value="Teknik Mesin">Teknik Mesin</option>
          <option value="Manajemen">Manajemen</option>
          <option value="Akuntansi">Akuntansi</option>
        </select>
      </div>
      <div class="mb-3">
        <label>Instansi / Tempat Bekerja</label>
        <input type="text" class="form-control" name="instansi">
      </div>
      <div class="mb-3">
        <label>Nama Mata Kuliah</label>
        <select class="form-control" name="matakul" id="matakul_select" required onchange="toggleMatakulInput(); setDosenByMatakuliah();">
          <option value="">-- Pilih Mata Kuliah --</option>
          <option value="Pemrograman Berorientasi Web">Pemrograman Berorientasi Web</option>
          <option value="Basis Data">Basis Data</option>
          <option value="Bahasa Indonesia">Bahasa Indonesia</option>
          <option value="Kecerdasan Artifisial">Kecerdasan Artifisial</option>
          <option value="Sistem Operasi">Sistem Operasi</option>
          <option value="Komputasi Numerik">Komputasi Numerik</option>
          <option value="Perancangan Dan Analisis Algoritma">Perancangan Dan Analisis Algoritma</option>
          <option value="Perancangan Sistem Informasi">Perancangan Sistem Informasi</option>
          <option value="Lainnya">Lainnya (isi manual)</option>
        </select>
        <input type="text" class="form-control mt-2" name="matakul_manual" id="matakul_manual" placeholder="Isi manual jika tidak ada di daftar" style="display:none;">
      </div>
      <div class="mb-3">
        <label>Nama Dosen Pengampu</label>
        <select class="form-control" name="dosen" id="dosen_select" required autocomplete="on">
          <option value="">-- Pilih Dosen --</option>
          <option value="Danang Haryo Sulaksono, S.ST., M.T.">Danang Haryo Sulaksono, S.ST., M.T.</option>
          <option value="Dr.Rahmi Rizkiana Putri, S.ST.,M.Kom.">Dr. Rahmi Rizkiana Putri, S.ST.,M.Kom.</option>
          <option value="Dr.Mochamad Junaidi Hidayat, ST, M.Ds">Dr. Mochamad Junaidi Hidayat, ST, M.Ds</option>
          <option value="Muchamad Kurniawan, S.Kom.,M.Kom.">Muchamad Kurniawan, S.Kom.,M.Kom.</option>
          <option value="Andy Rachman, S.T.,M.Kom.">Andy Rachman, S.T.,M.Kom.</option>
          <option value="Dr.Rinci Kembang Hapsari, S.Si.,M.Kom.">Dr. Rinci Kembang Hapsari, S.Si.,M.Kom.</option>
          <option value="Sugiyanto, S.E.,S.T.,M.M.,M.Kom., Ph.D.">Sugiyanto, S.E.,S.T.,M.M.,M.Kom., Ph.D.</option>
        </select>
      </div>
      <div class="mb-3">
        <label>Kelas</label>
        <input type="text" class="form-control" name="kelas" required>
      </div>
      <div class="mb-3">
        <label>Pertemuan ke-</label>
        <input type="number" class="form-control" name="pertemuan" required>
      </div>
      <div class="mb-3">
        <label>Tanggal</label>
        <input type="date" class="form-control" name="tanggal" required>
      </div>
      <div class="mb-3">
        <label>Alasan Izin</label>
        <textarea class="form-control" name="alasan" rows="3" required></textarea>
      </div>
      <div class="mb-3">
        <label>Tanggal Surat</label>
        <input type="date" class="form-control" name="tanggal_surat" required>
      </div>

      <div class="mb-3">
        <label>Tanda Tangan:</label><br>
        <canvas id="signature-pad" width="400" height="200"></canvas><br>
  <button type="button" class="btn btn-danger" onclick="clearPad()">Clear</button>
        <input type="hidden" name="tanda_tangan" id="tanda_tangan">
      </div>

      <button type="submit" class="btn btn-primary mt-3">Buat Surat</button>
    </form>
  <!-- tombol download dihapus -->
  </div>

  <!-- Signature Pad -->
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
  <script>
    var canvas = document.getElementById("signature-pad");
    var signaturePad = new SignaturePad(canvas);

    function clearPad() {
      signaturePad.clear();
    }

    // Mata kuliah: toggle input manual jika "Lainnya" dipilih
    function toggleMatakulInput() {
      var select = document.getElementById('matakul_select');
      var manual = document.getElementById('matakul_manual');
      if (select.value === 'Lainnya') {
        manual.style.display = '';
        manual.required = true;
      } else {
        manual.style.display = 'none';
        manual.required = false;
        manual.value = '';
      }
    }

    // Mapping mata kuliah ke dosen
    const matkulToDosen = {
      'Pemrograman Berorientasi Web': 'Danang Haryo Sulaksono, S.ST., M.T.',
      'Basis Data': 'Dr. Rahmi Rizkiana Putri, S.ST.,M.Kom.',
      'Bahasa Indonesia': 'Dr. Mochamad Junaidi Hidayat, ST, M.Ds',
      'Kecerdasan Artifisial': 'Muchamad Kurniawan, S.Kom.,M.Kom.',
      'Sistem Operasi': 'Andy Rachman, S.T.,M.Kom.',
      'Komputasi Numerik': 'Dr. Rinci Kembang Hapsari, S.Si.,M.Kom.',
      'Perancangan Sistem Informasi': 'Sugiyanto, S.E.,S.T.,M.M.,M.Kom., Ph.D.'
    };

    function setDosenByMatakuliah() {
      var matkul = document.getElementById('matakul_select').value;
      var dosenSelect = document.getElementById('dosen_select');
      if (matkulToDosen[matkul]) {
        dosenSelect.value = matkulToDosen[matkul];
      } else {
        dosenSelect.value = '';
      }
    }

    // Saat submit, jika manual diisi, override value select
    document.querySelector("form").addEventListener("submit", function (e) {
      var select = document.getElementById('matakul_select');
      var manual = document.getElementById('matakul_manual');
      if (select.value === 'Lainnya' && manual.value.trim() !== '') {
        // Buat input hidden agar value manual dikirim sebagai 'matakul'
        var hidden = document.createElement('input');
        hidden.type = 'hidden';
        hidden.name = 'matakul';
        hidden.value = manual.value;
        select.form.appendChild(hidden);
        select.disabled = true; // agar select tidak ikut terkirim
      }
      if (!signaturePad.isEmpty()) {
        var dataURL = signaturePad.toDataURL();
        document.getElementById("tanda_tangan").value = dataURL;
      }
    });
  </script>
</body>
</html>
